<!doctype html>
<html>
<title>Flaskr</title>
<link rel=stylesheet type=text/css href="style.css">
    
<!-- Vendors -->
<script src="js/jquery.js"></script>
<script src="js/mustache.js"></script>
<script src="js/sammy.js"></script>
<script src="js/parse.js"></script>
<script id="facebook-jssdk" type="text/javascript" src="//connect.facebook.net/en_US/all.js"></script>

<!-- My libs -->
<script src="js/prototype_class.js"></script>
<script src="js/repository.js"></script>
<script src="js/etc.js"></script>

<!-- Views -->

<!-- Repositories -->
<script src="repositories/parse.js"></script>


<script>
    
    function facebook_init (callback) {
        
        function facebookReady(){
            // init metodo do facebook, nenhuma funcao do SDK deve ser chamada anstes dela 
            Parse.FacebookUtils.init({
                appId: '746689365373836',
                //status: false, // don't get info about the current user after init
                cookie: true, // enable cookies to allow the server to access the session
                xfbml: true, // find and initialize any social plugins that have been added using XFBML
                version: 'v1.0', // determine which Graph API version is used.
                //oauth: true
            });

        }

        if(window.FB) {
            facebookReady();
        } else {
            window.fbAsyncInit = facebookReady;
        }

    }
    
    /*Iniciando objetos PARSE*/
    Parse.initialize("XX", "YY");
        
    var TestSuite = PrototypeClass.extend({
        
        postImage: function() {
    
            ParseRepository.uploadFile({
                name: "image",
                ext: ".png",
                content_type: "image/png",
                file_upload_control: $("#profile_image")[0],
            });

        },
        
        facebook_login: function() {
            var repository = ParseRepository.g.user;
            repository.facebook_login({});
            this.test_user();
            //repository.login({username: $("#username").val(), password: $("#password").val()});
            //repository.current();
            
        },

        test_user: function(){
            var repository = ParseRepository.g.user;
            
            function show_response(response){
                console.log(JSON.stringify(response));
            }

            function unlink(response){
                repository.facebook_unlink({id: response.id});
            };

            function delete_user(response){
                repository.delete({id: response.id});
            };
            
            //repository.find({username: "fernando"});
            //repository.signup({username: "fernando2" + Math.random(), password: "123"}, show_response);
            //repository.current(show_response);
            //repository.getAll(show_response);
            //repository.first(null, show_response);
            repository.current(delete_user);
        },

        run: function() {
            
            console.log(Object.getPrototypeOf(this));
                    
            for (key in TestSuite){
                if (key.substring(0, 5) === "test_"){
                    TestSuite[key]();
                }
            }

        }

    });

    $(document).ready(function(){

        facebook_init();

        $("button#upload").on("click", function(e){
            e.preventDefault();
            TestSuite.postImage();
        });

        $("button#login").on("click", function(e){
            e.preventDefault();
            TestSuite.facebook_login();
        });

        TestSuite.run();
        
    });
    

</script>

<body>
    <div id="fb-root"></div>

    <div class=page>

        <h1>PÃ¡gina de testes do parse</h1>
        
        <div id="content">
        
            </form>
               
                <input type="file" id="profile_image">
                
                <button id="upload">
                    upload                    
                </button>
                
            </form>
            
            <br>
            
            </form>
               
                <input type="text" id="username" value="fernando2">
                
                <input type="password" id="password" value="123">
                
                <button id="login">
                    login               
                </button>
                
            </form>
        
        </div>
    </div>
    
    <!-- Usando o SDK para adicionar o Social Plugin "Like button" com o xfbml -->
<!-- https://developers.facebook.com/docs/plugins -->        
<div
  class="fb-like"
  data-send="true"
  data-width="450"
  data-show-faces="true">
</div>

</body>
</html>